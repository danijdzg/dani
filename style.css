/* ================================================================= */
/* === VARIABLES Y TEMAS (Configuración Global)                   === */
/* ================================================================= */

:root {
    /* TEMA 1: "ABISMO DIGITAL" (Oscuro Profesional) */
    --c-primary: #00B34D;       /* Verde Esmeralda */
    --c-primary-hover: #00CC55;
    --c-danger: #FF3B30;
    --c-success: #39FF14;
    --c-warning: #FFD60A;
    --c-info: #BF5AF2;
    
    /* FONDOS Y SUPERFICIES */
    --c-background: #0A121A;    /* Azul Noche Profundo */
    --c-surface: rgba(28, 42, 58, 0.6); /* Glassmorphism sutil */
    --c-surface-variant: rgba(42, 58, 78, 0.5);
    
    /* BORDES Y LÍNEAS */
    --c-outline: rgba(255, 255, 255, 0.1);
    --c-border-glow: 0 0 12px rgba(0, 179, 77, 0.4);
    
    /* TEXTOS */
    --c-on-surface: #F0F8FF;
    --c-on-surface-secondary: rgba(240, 248, 255, 0.85);
    --c-on-surface-tertiary: rgba(240, 248, 255, 0.70);
    
    /* SOMBRAS */
    --shadow-sm: 0 0 8px rgba(0, 0, 0, 0.25);
    --shadow-md: 0 0 20px rgba(0, 0, 0, 0.45);
    --glow-red: 0 0 20px rgba(255, 59, 48, 0.55);

    /* VARIABLES BASE */
    --c-white: #FFFFFF; --c-black: #000000;
    --c-chart-positive: var(--c-success); --c-chart-negative: var(--c-danger);
    --font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
    --fs-xs: 0.75rem; --fs-sm: 0.875rem; --fs-base: 1rem; --fs-lg: 1.125rem; --fs-xl: 1.25rem;
    --sp-1: 0.25rem; --sp-2: 0.5rem; --sp-3: 0.75rem; --sp-4: 1rem; --sp-5: 1.25rem; --sp-6: 1.5rem;
    --border-radius-md: 10px; --border-radius-lg: 16px;
}

body[data-theme="sunset-groove"] {
    /* TEMA 2: "BRISA ALPINA" (Claro Profesional) */
    --c-primary: #007AFF;
    --c-primary-hover: #0056b3;
    --c-danger: #D92A2A;
    --c-success: #28a745;
    --c-warning: #FF9500;
    --c-info: #5856D6;
    
    /* FONDOS Y SUPERFICIES */
    --c-background: #F7F7F7;
    --c-surface: rgba(255, 255, 255, 0.8);
    --c-surface-variant: rgba(255, 255, 255, 0.7);
    --c-outline: rgba(60, 60, 67, 0.12);
    
    /* TEXTOS */
    --c-on-surface: #1D1D1F;
    --c-on-surface-secondary: #3C3C4399;
    --c-on-surface-tertiary: #3C3C4380;
    
    /* SOMBRAS */
    --shadow-sm: 0 4px 15px rgba(0, 0, 0, 0.06);
    --shadow-md: 0 8px 30px rgba(0, 0, 0, 0.12);
}

/* ================================================================= */
/* === ESTILOS BASE Y ESTRUCTURALES                               === */
/* ================================================================= */

* { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
html { height: -webkit-fill-available; scroll-behavior: smooth; }
body { font-family: var(--font-family); background-color: var(--c-background); color: var(--c-on-surface); line-height: 1.4; min-height: 100vh; min-height: -webkit-fill-available; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; overflow: hidden; font-weight: 500; }
*:focus-visible { outline: 2px solid var(--c-primary); outline-offset: 2px; border-radius: var(--sp-2); }

/* --- Animaciones --- */
@keyframes fade-out-and-collapse { from { opacity: 1; transform: scaleY(1); max-height: 76px; } to { opacity: 0; transform: scaleY(0.8); max-height: 0; padding-top: 0; padding-bottom: 0; margin: 0; border: 0; } }
.item-deleting { animation: fade-out-and-collapse 0.4s ease-out forwards; overflow: hidden; border-bottom: none !important; }

@keyframes item-enter { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
.list-item-animate { opacity: 0; }
.list-item-animate.item-enter-active { animation: item-enter 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards; }

@keyframes pop-in { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }
@keyframes slide-in-from-right { from { transform: translateX(100%); opacity: 0.8; } to { transform: translateX(0); opacity: 1; } }
@keyframes slide-out-to-left { from { transform: translateX(0); opacity: 1; } to { transform: translateX(-100%); opacity: 0.8; } }
@keyframes slide-in-from-left { from { transform: translateX(-100%); opacity: 0.8; } to { transform: translateX(0); opacity: 1; } }
@keyframes slide-out-to-right { from { transform: translateX(0); opacity: 1; } to { transform: translateX(100%); opacity: 0.8; } }

.view-transition-in-forward { animation: slide-in-from-right 0.35s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards; }
.view-transition-out-forward { animation: slide-out-to-left 0.35s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards; }
.view-transition-in-backward { animation: slide-in-from-left 0.35s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards; }
.view-transition-out-backward { animation: slide-out-to-right 0.35s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards; }

@keyframes view-fade-in { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
@keyframes view-fade-out { from { opacity: 1; } to { opacity: 0; } }
.view-entering { animation: view-fade-in 0.3s ease-out forwards; }
.view-exiting { animation: view-fade-out 0.2s ease-in forwards; }

@keyframes highlight-card { 0% { background-color: color-mix(in srgb, var(--c-primary) 15%, transparent); } 100% { background-color: transparent; } }
.highlight-animation { animation: highlight-card 2s ease-out; }

@keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
.skeleton { background-color: var(--c-surface-variant); background-image: linear-gradient(90deg, var(--c-surface-variant), color-mix(in srgb, var(--c-outline) 20%, var(--c-surface-variant)), var(--c-surface-variant)); background-size: 200% 100%; animation: shimmer 1.5s infinite linear; border-radius: var(--sp-2); color: transparent !important; user-select: none; }
.skeleton > * { visibility: hidden; }

/* --- Animación de Guardado (burbuja) --- */
.save-animation-bubble {
    width: 20px; height: 20px; border-radius: 50%; position: fixed;
    z-index: 2147483647; /* Máxima prioridad */
    opacity: 0; pointer-events: none;
    transition: transform 0.7s cubic-bezier(0.5, -0.5, 0.5, 1.5), opacity 0.7s;
}
@keyframes fly-to-list {
    0% { opacity: 0.8; transform: scale(1.2); }
    99% { opacity: 0.1; transform: scale(0.2); }
    100% { opacity: 0; transform: scale(0); }
}

@keyframes btn-success-pulse {
    0% { transform: scale(1); } 50% { transform: scale(1.05); box-shadow: 0 0 15px var(--c-success); } 100% { transform: scale(1); }
}
.btn--success-state {
    background-color: var(--c-success) !important; border-color: var(--c-success) !important; color: var(--c-white) !important;
    transition: all 0.2s ease-out; animation: btn-success-pulse 0.4s ease-out;
}

/* --- Estructura de la App --- */
.app-layout { display: none; max-width: 500px; margin: 0 auto; height: 100vh; background-color: var(--c-background); flex-direction: column; opacity: 0; transition: opacity 0.5s ease-out, transform 0.4s cubic-bezier(0.4, 0, 0.2, 1), border-radius 0.4s; }
.app-layout--visible { display: flex; opacity: 1; }
.app-layout__main { flex: 1; overflow-y: auto; -webkit-overflow-scrolling: touch; padding: 44px 0 48px 0; }
.view { display: none; flex-direction: column; width: 100%; padding: 0 var(--sp-4); gap: var(--sp-4); }
.view--active { display: flex; }

/* --- Navegación Superior (Top Bar) --- */
.top-bar {
    display: flex; align-items: center; justify-content: space-between; padding: var(--sp-2) var(--sp-4);
    background-color: rgba(28, 42, 58, 0.75); backdrop-filter: blur(20px) saturate(180%); -webkit-backdrop-filter: blur(20px) saturate(180%);
    border-top: 1px solid rgba(255, 255, 255, 0.15); border-bottom: 1px solid var(--c-outline);
    z-index: 200; height: 44px; position: fixed; top: 0; left: 50%; transform: translateX(-50%); width: 100%; max-width: 500px;
    transition: background-color 0.3s ease-in-out; color: var(--c-white);
}
body[data-ledger-mode="A"] .top-bar { background-color: #002D5B; }
body[data-ledger-mode="B"] .top-bar { background-color: #5B0000; }
body[data-theme] .top-bar .btn, body[data-theme] .top-bar .icon-btn, body[data-theme] .top-bar #page-title-display { color: var(--c-white); }

.top-bar__title { font-size: var(--fs-lg); font-weight: 800; padding-left: var(--sp-2); text-align: center; }
#page-title-display { font-size: var(--fs-base); font-weight: 700; margin-left: var(--sp-3); color: inherit; white-space: nowrap; }
.top-bar__actions { display: flex; align-items: center; gap: var(--sp-1); }
.top-bar__left-button { min-width: 85px; display: flex; align-items: center; }
.top-bar__left-group { display: flex; align-items: center; gap: var(--sp-3); }

.top-bar .top-bar__actions .icon-btn { width: 40px; height: 40px; transition: transform 0.2s ease-out, background-color 0.2s ease-out; }
.top-bar .top-bar__actions .icon-btn .material-icons { font-size: 24px; color: var(--c-on-surface-secondary); transition: color 0.2s, transform 0.2s; }
.top-bar .top-bar__actions .icon-btn:hover .material-icons { color: var(--c-white); transform: scale(1.1); }
.top-bar .top-bar__actions .icon-btn:active { transform: scale(0.9); }

/* --- Navegación Inferior (Bottom Nav) --- */
.bottom-nav { 
    align-items: flex-end; position: fixed; bottom: 0; left: 50%; transform: translateX(-50%); width: 100%; max-width: 500px;
    background-color: var(--c-surface); border-top: 1px solid var(--c-outline); display: flex;
    padding-bottom: env(safe-area-inset-bottom); z-index: 200; box-shadow: 0 -2px 15px rgba(0,0,0,0.2); height: 48px;
}
.bottom-nav__item { 
    flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: var(--sp-1) var(--sp-2);
    cursor: pointer; transition: color 0.2s; color: var(--c-on-surface-secondary); border: none; background: none;
}
.bottom-nav__item--active { color: var(--c-primary); }
body[data-ledger-mode="B"] .bottom-nav__item--active { color: var(--c-danger) !important; }
.bottom-nav__item .material-icons { font-size: 22px; } 
.bottom-nav__label { display: none; font-size: var(--fs-xs); margin-top: 2px; }

/* Botón Central Flotante */
#bottom-nav-add-btn {
    width: 56px; height: 56px; background-color: var(--c-primary); color: var(--c-white); border: none; border-radius: 50%;
    display: flex; align-items: center; justify-content: center; margin-bottom: 12px; box-shadow: var(--shadow-md);
    cursor: pointer; transition: all 0.2s ease-in-out;
}
#bottom-nav-add-btn:hover { transform: scale(1.1) rotate(15deg); background-color: var(--c-primary-hover); }
#bottom-nav-add-btn:active { transform: scale(0.95); }
#bottom-nav-add-btn .material-icons { font-size: 28px; font-weight: 700; }

/* --- Contabilidad Dual Botón --- */
body[data-ledger-mode="A"] #ledger-toggle-btn { background-color: var(--c-primary); border-color: var(--c-primary); color: var(--c-white); box-shadow: 0 0 10px rgba(0, 122, 255, 0.5); }
body[data-ledger-mode="A"] #ledger-toggle-btn:hover { background-color: var(--c-primary-hover); border-color: var(--c-primary-hover); }
body[data-ledger-mode="B"] #ledger-toggle-btn { background-color: var(--c-danger); border-color: var(--c-danger); color: var(--c-white); box-shadow: var(--glow-red); }
body[data-ledger-mode="B"] #ledger-toggle-btn:hover { background-color: color-mix(in srgb, var(--c-danger) 85%, black); border-color: color-mix(in srgb, var(--c-danger) 85%, black); }
#ledger-toggle-btn { font-weight: 700; padding: 6px 10px; font-size: 0.8rem; min-width: 40px; text-align: center; }

/* ================================================================= */
/* === MODALES Y VENTANAS EMERGENTES                              === */
/* ================================================================= */

.modal-overlay { 
    position: fixed; inset: 0; background: rgba(0,0,0,0.6); backdrop-filter: blur(20px) saturate(180%); -webkit-backdrop-filter: blur(20px) saturate(180%);
    background-color: rgba(28, 42, 58, 0.75); border-top: 1px solid rgba(255, 255, 255, 0.15);
    display: flex; align-items: flex-end; justify-content: center; z-index: 1050; opacity: 0; transition: opacity 0.3s ease-out; pointer-events: none;
}
.modal-overlay--active { opacity: 1; pointer-events: auto; }
.app-layout--transformed-by-modal { transform: scale(0.92) translateY(-10px); border-radius: 20px; opacity: 0.8; transition: all 0.4s cubic-bezier(0.32, 0.72, 0, 1); }

.modal { 
    background: var(--c-surface); border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0; padding: var(--sp-5);
    width: 100%; max-width: 420px; max-height: 90vh; display: flex; flex-direction: column; box-shadow: 0 0 30px rgba(0,0,0,0.5);
    transform: translateY(100%); transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1); overflow: hidden;
}
.modal-overlay--active .modal { transform: translateY(0); }
.modal__header { display: flex; align-items: center; justify-content: space-between; margin-bottom: var(--sp-3); flex-shrink: 0; }
.modal__title { font-size: var(--fs-xl); font-weight: 800; }
.modal__body { overflow-y: auto; flex-grow: 1; -webkit-overflow-scrolling: touch; padding-right: var(--sp-2); margin-right: calc(-1 * var(--sp-2)); padding-bottom: 0 !important; }
.modal__actions { margin-top: var(--sp-4); display: flex; justify-content: flex-end; gap: var(--sp-2); width: 100%; flex-shrink: 0; background-color: var(--c-surface); border-top: 1px solid var(--c-outline); padding: var(--sp-3) var(--sp-4); z-index: 10; position: relative; padding-bottom: calc(var(--sp-3) + env(safe-area-inset-bottom)); box-shadow: 0 -4px 20px rgba(0,0,0,0.2); }
.modal__grabber { width: 40px; height: 5px; background-color: var(--c-outline); border-radius: 99px; position: absolute; top: 8px; left: 50%; transform: translateX(-50%); }
.modal__list-item { display:flex; justify-content:space-between; align-items:center; padding: var(--sp-3) 0; border-bottom:1px solid var(--c-outline); gap: var(--sp-2); }
.modal__list-item:last-child { border-bottom: none; }

/* Contenido Genérico Modal */
#generic-modal-body h3, #generic-modal-body h4 { margin-top: 1.2em; margin-bottom: 0.6em; color: var(--c-primary); font-weight: 700; } 
#generic-modal-body h4 { font-size: var(--fs-base); } 
#generic-modal-body p, #generic-modal-body li, #generic-modal-body small { color: var(--c-on-surface-secondary); line-height: 1.5; } 
#generic-modal-body ul, #generic-modal-body ol { list-style-position: inside; padding-left: var(--sp-2); } 
#generic-modal-body ul li, #generic-modal-body ol li { margin-bottom: 6px; } 
#generic-modal-body a { color: var(--c-primary); text-decoration: none; font-weight: 600; }
#generic-modal-body a:hover { text-decoration: underline; }

/* Menú Desplegable (Popover) */
.popover-menu {
    position: fixed; top: 52px; right: 12px; z-index: 1100; background-color: var(--c-surface-variant); border-radius: var(--border-radius-md);
    border: 1px solid var(--c-outline); box-shadow: var(--shadow-md); width: 220px; padding: var(--sp-2);
    opacity: 0; transform: translateY(-10px) scale(0.95); transform-origin: top right; transition: opacity 0.2s ease-out, transform 0.2s ease-out; pointer-events: none;
}
.popover-menu--visible { opacity: 1; transform: translateY(0) scale(1); pointer-events: auto; }
.popover-menu__item { display: flex; align-items: center; gap: var(--sp-3); width: 100%; padding: var(--sp-2) var(--sp-3); border-radius: 6px; border: none; background: none; cursor: pointer; text-align: left; font-size: var(--fs-sm); font-weight: 500; color: var(--c-on-surface); transition: background-color 0.2s; }
.popover-menu__item:hover { background-color: var(--c-surface); }
.popover-menu__item .material-icons { color: var(--c-on-surface-secondary); }
.popover-menu__item--danger, .popover-menu__item--danger .material-icons { color: var(--c-danger); }
.popover-menu__divider { height: 1px; background-color: var(--c-outline); margin: var(--sp-2) 0; }

/* Bottom Sheet Acciones Rápidas */
#main-add-sheet-body { display: flex; flex-direction: column; gap: var(--sp-2); }
.add-sheet-button {
    display: flex; align-items: center; gap: var(--sp-3); padding: var(--sp-3); background-color: var(--c-surface-variant);
    border: none; border-radius: var(--border-radius-lg); font-size: var(--fs-base); font-weight: 600; color: var(--c-on-surface);
    text-align: left; width: 100%; cursor: pointer; transition: background-color 0.2s, transform 0.2s;
}
.add-sheet-button:hover { background-color: color-mix(in srgb, var(--c-primary) 10%, transparent); }
.add-sheet-button:active { transform: scale(0.98); }

/* ================================================================= */
/* === COMPONENTES DE TARJETAS Y LISTAS                           === */
/* ================================================================= */

.card__title { font-size: var(--fs-lg); font-weight: 700; margin-bottom: var(--sp-3); display: flex; align-items: center; gap: var(--sp-2); padding: var(--sp-4) var(--sp-4) 0 var(--sp-4); }
.card__content { padding: 0 var(--sp-4) var(--sp-4) var(--sp-4); }
.card__title .material-icons { font-size: var(--fs-lg); }
.card--no-bg { background: none; border: none; box-shadow: none; padding: 0; border-radius: 0; }

/* Tarjeta de Transacción */
.transaction-card { display: flex; align-items: flex-start; padding: var(--sp-2) 0; cursor: pointer; border-bottom: 1px solid var(--c-outline); line-height: 1.25; min-height: 64px; transition: background-color 0.2s; user-select: none; transition: transform 0.2s ease-out, background-color 0.2s; }
.transaction-card.is-pressing { transform: scale(0.96); background-color: var(--c-surface-variant); transition: transform 0.2s cubic-bezier(0.4, 0, 0.2, 1); }
.transaction-card:hover { background-color: var(--c-surface-variant); }
.transaction-card:last-child { border-bottom: none; }
.transaction-card:active { background-color: var(--c-surface-variant); transform: scale(0.98); transition: transform 0.1s ease-out; }

.transaction-card__indicator { flex-shrink: 0; width: 3px; align-self: stretch; border-radius: 99px; margin-right: var(--sp-2); }
.transaction-card__indicator--income { background-color: var(--c-success); }
.transaction-card__indicator--expense { background-color: var(--c-danger); }
.transaction-card__indicator--transfer { background-color: var(--c-info); }
.transaction-card__indicator--recurrent { background-color: var(--c-warning); }

.transaction-card__content { flex-grow: 1; display: flex; justify-content: space-between; align-items: center; min-width: 0; }
.transaction-card__details { flex-grow: 1; min-width: 0; padding-right: var(--sp-2); }
.transaction-card__row-1, .transaction-card__concept { font-size: var(--fs-sm); font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.transaction-card__row-2, .transaction-card__description { font-size: var(--fs-xs); color: var(--c-on-surface-secondary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.transaction-card__figures { flex-shrink: 1; text-align: right; min-width: 120px; display: flex; flex-direction: column; align-items: flex-end; gap: 8px; }
.transaction-card__amount { font-size: var(--fs-sm); font-weight: 700; display: block; }
.transaction-card__balance { font-size: 0.7rem; color: var(--c-on-surface-secondary); display: block; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 100px; }
.transaction-card__transfer-details { display: flex; flex-direction: column; gap: 0; margin: 2px 0 0 0; }
.transaction-card__transfer-row { display: flex; justify-content: space-between; align-items: center; color: var(--c-on-surface-secondary); font-size: 0.75rem; }
.transaction-card__transfer-row .material-icons { font-size: 11px; vertical-align: middle; margin-right: var(--sp-1); }
.transaction-card__transfer-row > span:first-child { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.transaction-card__recurrent-actions { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }

/* Lista Virtualizada */
#movimientos-list-container { position: relative; padding: 0 var(--sp-4); }
#virtual-list-sizer { position: relative; width: 100%; }
#virtual-list-content { position: absolute; top: 0; left: 0; width: 100%; }

/* Headers de Fecha y Mes */
.movimiento-date-header {
    display: flex; justify-content: space-between; align-items: center; padding: 6px 12px;
    background-color: color-mix(in srgb, var(--c-surface-variant) 85%, transparent); color: var(--c-on-surface);
    font-weight: 700; font-size: var(--fs-sm); border-radius: 99px; margin-top: var(--sp-4); margin-bottom: var(--sp-2);
}
.movimiento-date-header.is-today { background-color: var(--c-primary); color: var(--c-white); box-shadow: 0 0 12px var(--c-primary); }
.movimiento-month-header {
    background-color: var(--c-surface); padding: var(--sp-3) var(--sp-4); margin-top: var(--sp-4);
    border-radius: var(--border-radius-lg); border: 1px solid var(--c-outline); box-shadow: var(--shadow-sm);
    display: flex; justify-content: space-between; align-items: center;
}
.movimiento-month-header__title { font-size: var(--fs-lg); font-weight: 800; color: var(--c-primary); text-transform: capitalize; }
.movimiento-month-header__summary { text-align: right; }
.movimiento-month-header__summary p { margin: 0; font-size: var(--fs-sm); font-weight: 700; }

/* ================================================================= */
/* === FORMULARIOS Y INPUTS                                       === */
/* ================================================================= */

.form-group { margin-bottom: var(--sp-3); position: relative; }
.form-label { display: block; font-size: var(--fs-sm); font-weight: 600; margin-bottom: var(--sp-2); color: var(--c-on-surface-secondary); }
.form-input, .form-select { 
    width: 100%; padding: var(--sp-3); border: 1px solid var(--c-outline); border-radius: var(--border-radius-md);
    background: var(--c-surface-variant); color: var(--c-on-surface); font-size: var(--fs-base); appearance: none;
    transition: border-color 0.2s, box-shadow 0.2s, background-color 0.2s;
}
.form-input:focus, .form-select:focus { outline: none; border-color: var(--c-primary); background-color: var(--c-surface); box-shadow: var(--c-border-glow); }
.form-input--error { border: 2px solid red; background: #ffecec; }
.form-input--invalid { border-color: var(--c-danger) !important; box-shadow: var(--glow-red) !important; }
.form-error { color: var(--c-danger); font-size: var(--fs-xs); margin-top: var(--sp-1); min-height: 14px; display: block; font-weight: 600; }
.form-grid { display: grid; grid-template-columns: 1fr; gap: var(--sp-3); }

/* Selector de Tipo (Pills) */
.filter-pills { display: flex; flex-wrap: wrap; gap: 4px; margin-bottom: 8px; justify-content: center; }
.filter-pill { padding: 4px 12px; border: 1px solid var(--c-outline); border-radius: 99px; font-size: 0.75rem; font-weight: 600; background-color: var(--c-surface-variant); color: var(--c-on-surface); cursor: pointer; transition: all 0.2s; height: 28px; line-height: 20px; }
.filter-pill[data-type="gasto"].filter-pill--active { background-color: var(--c-danger); border-color: var(--c-danger); color: var(--c-white); }
.filter-pill[data-type="ingreso"].filter-pill--active { background-color: var(--c-success); border-color: var(--c-success); color: var(--c-white); }
.filter-pill[data-type="traspaso"].filter-pill--active { background-color: var(--c-info); border-color: var(--c-info); color: var(--c-white); }

/* Formulario Compacto ("Cero Scroll") */
.dense-form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 8px; }
#movimiento-cantidad-form-group { grid-column: 1 / -1; margin-bottom: 4px; }
#movimiento-fields, #traspaso-fields { display: contents; }
.form-field-compact { position: relative; }
.form-field-compact:has(#movimiento-concepto), .form-field-compact:has(#movimiento-cuenta), .form-field-compact:has(#movimiento-cuenta-origen), .form-field-compact:has(#movimiento-cuenta-destino) { grid-column: span 1; }
.form-field-compact:has(#movimiento-descripcion) { grid-column: 1 / -1; }

.form-field-compact .input-wrapper { background-color: var(--c-surface-variant); border: 1px solid var(--c-outline); border-radius: var(--border-radius-md); display: flex; align-items: center; height: 50px; transition: border-color 0.2s; position: relative; }
.form-field-compact input, .form-field-compact select, .custom-select__trigger { height: 100%; width: 100%; border: none; background: transparent; padding: 0 12px !important; font-size: 0.85rem; font-weight: 600; color: var(--c-on-surface); border-radius: 8px; line-height: 50px; }
.form-field-compact > label { display: none; }

/* Campo de Importe Destacado */
#movimiento-cantidad-form-group .input-wrapper { height: 60px; background-color: var(--c-surface); border-color: var(--c-primary); }
#movimiento-cantidad { flex-grow: 1; text-align: center; font-size: 1.5rem !important; font-weight: 800; padding-top: 10px !important; padding-right: 8px; line-height: 1.2; }
#movimiento-cantidad-form-group.is-ingreso #movimiento-cantidad { border-color: var(--c-success); color: var(--c-success); }
#movimiento-cantidad-form-group.is-gasto #movimiento-cantidad { border-color: var(--c-danger); color: var(--c-danger); }
#movimiento-cantidad-form-group.is-traspaso #movimiento-cantidad { border-color: var(--c-info); color: var(--c-info); }
#movimiento-cantidad-form-group label { width: 100%; text-align: center; left: 0; top: 4px; color: var(--c-primary); position: absolute; font-size: 0.55rem; font-weight: 700; text-transform: uppercase; }

/* Sugerencias y Chips */
#description-suggestions { display: none; position: absolute; top: 100%; left: 0; right: 0; background-color: var(--c-surface); border-radius: var(--border-radius-md); box-shadow: 0 10px 20px rgba(0,0,0,0.4); z-index: 1060; max-height: 150px; overflow-y: auto; border: 1px solid var(--c-outline); }
.suggestion-item { padding: var(--sp-2) var(--sp-3); cursor: pointer; font-size: var(--fs-sm); }
.suggestion-item:hover { background-color: var(--c-surface-variant); }
.suggestion-item small { color: var(--c-on-surface-secondary); font-size: var(--fs-xs); }

#quick-access-chips { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 8px; margin-bottom: 12px; scrollbar-width: none; grid-column: 1 / -1; }
#quick-access-chips::-webkit-scrollbar { display: none; }
.quick-chip { height: 26px; font-size: 0.7rem; padding: 0 10px; display: flex; align-items: center; gap: 6px; background-color: var(--c-surface-variant); border: 1px solid var(--c-outline); border-radius: 20px; color: var(--c-on-surface); font-weight: 600; white-space: nowrap; cursor: pointer; transition: all 0.2s; flex-shrink: 0; }
.quick-chip .material-icons { font-size: 16px; color: var(--c-primary); }
.quick-chip:active { background-color: var(--c-primary); color: white; border-color: var(--c-primary); }
.quick-chip:active .material-icons { color: white; }

/* Fecha y Recurrente */
.date-recurrent-row { display: flex; gap: 8px; margin-top: 4px; height: 42px; align-items: stretch; }
.date-button-compact { flex: 1; height: 100%; font-size: 0.8rem; font-weight: 600; padding: 0 8px; border-radius: var(--border-radius-md); background-color: var(--c-surface-variant); border: 1px solid var(--c-outline); color: var(--c-on-surface); display: flex; align-items: center; justify-content: center; gap: 6px; cursor: pointer; }
.date-button-compact .material-icons { color: var(--c-on-surface-secondary); font-size: 18px; }
.recurrent-toggle-compact { flex: 0 0 auto; height: 100%; display: flex; align-items: center; gap: 8px; padding: 0 12px; background-color: var(--c-surface-variant); border: 1px solid var(--c-outline); border-radius: var(--border-radius-md); }
.recurrent-toggle-compact label { font-size: 0.75rem; font-weight: 600; color: var(--c-on-surface-secondary); }

#recurrent-options { margin-top: 8px; padding: 10px; background-color: var(--c-surface-variant); border-radius: var(--border-radius-md); border: 1px solid var(--c-warning); display: flex; flex-direction: column; gap: var(--sp-3); }
#recurrent-options select, #recurrent-options input { background-color: var(--c-surface); border-radius: 6px; font-size: 0.8rem; padding: 6px 8px; color: var(--c-on-surface); border: 1px solid var(--c-outline); }
.recurrent-options__main { display: flex; gap: var(--sp-2); }
#weekly-day-selector-buttons { display: flex; justify-content: space-between; gap: 4px; margin-top: 6px; }
.day-selector-btn { flex: 1; height: 36px; border: 1px solid var(--c-outline); background-color: var(--c-surface); color: var(--c-on-surface-secondary); border-radius: 8px; font-weight: 700; cursor: pointer; transition: all 0.2s ease-in-out; }
.day-selector-btn:hover { border-color: var(--c-primary); }
.day-selector-btn.active { background-color: var(--c-primary); border-color: var(--c-primary); color: var(--c-white); transform: scale(1.05); }

/* Form Switch */
.form-switch-group { display: flex; align-items: center; justify-content: space-between; }
.form-switch { position: relative; display: inline-block; width: 36px; height: 20px; }
.form-switch input { opacity: 0; width: 0; height: 0; }
.form-switch .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: var(--c-surface-variant); transition: .4s; border-radius: 34px; border: 1px solid var(--c-outline); }
.form-switch .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 2px; bottom: 1px; background-color: white; transition: .4s; border-radius: 50%; }
.form-switch input:checked + .slider { background-color: var(--c-success); border-color: var(--c-success); }
.form-switch input:checked + .slider:before { transform: translateX(16px); }

/* Dropdown Personalizado */
.custom-select-wrapper { position: relative; width: 100%; }
.custom-select__trigger { position: relative; width: 100%; padding: 22px 32px 6px 12px !important; border-radius: var(--border-radius-md); background: transparent; color: var(--c-on-surface); font-size: 0.95rem; font-weight: 500; cursor: pointer; transition: border-color 0.2s, box-shadow 0.2s; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; border: none; display: flex; align-items: center; min-height: 50px; }
.custom-select-wrapper.is-open .input-wrapper { border-color: var(--c-primary); box-shadow: var(--c-border-glow); }
.custom-select__trigger::after { content: ''; position: absolute; right: 12px; top: 50%; margin-top: 4px; transform: translateY(-50%); width: 0; height: 0; border-left: 5px solid transparent; border-right: 5px solid transparent; border-top: 6px solid var(--c-on-surface-secondary); transition: transform 0.2s ease-in-out; }
.custom-select-wrapper.is-open .custom-select__trigger::after { transform: translateY(-50%) rotate(180deg); }
.custom-select__options { position: absolute; top: calc(100% + 4px); left: 0; right: 0; background-color: var(--c-surface); border: 1px solid var(--c-outline); border-radius: var(--border-radius-md); box-shadow: var(--shadow-md); z-index: 1070; max-height: 200px; overflow-y: auto; opacity: 0; visibility: hidden; transform: translateY(-10px); transition: opacity 0.2s ease, transform 0.2s ease, visibility 0.2s; transform-origin: top center; animation: dropdown-scale-in 0.15s ease-out forwards; }
.custom-select-wrapper.is-open .custom-select__options { opacity: 1; visibility: visible; transform: translateY(0); }
@keyframes dropdown-scale-in { 0% { opacity: 0; transform: translateY(-10px) scale(0.98); } 100% { opacity: 1; transform: translateY(0) scale(1); } }
.custom-select__option { padding: 10px 12px; color: var(--c-on-surface-secondary); font-weight: 500; cursor: pointer; transition: background-color 0.2s, color 0.2s; display: flex; align-items: center; gap: 10px; border-bottom: 1px solid var(--c-outline); }
.custom-select__option:hover { background-color: var(--c-surface-variant); color: var(--c-on-surface); }
.custom-select__option.is-selected { background-color: var(--c-primary); color: var(--c-white); font-weight: 600; }
.custom-select__option.is-selected .material-icons { color: var(--c-white); }
.custom-select__option .material-icons { color: var(--c-on-surface-secondary); }
.custom-select__option:last-child { border-bottom: none; }
.custom-select-wrapper .form-select-hidden { position: absolute; top: 0; left: 0; width: 1px; height: 1px; opacity: 0; pointer-events: none; }

/* ================================================================= */
/* === GRÁFICOS, KPI Y DASHBOARD                                  === */
/* ================================================================= */

.chart-container { position: relative; height: 220px; width: 100%; margin-bottom: var(--sp-4); }
.kpi-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: var(--sp-3); }
.kpi-item { border-radius: var(--border-radius-lg); padding: var(--sp-3); text-align: center; transition: background-color 0.3s, transform 0.2s; cursor: pointer; border: none; background: none; text-align: inherit; font-family: inherit; }
.kpi-item:hover { background-color: var(--c-surface-variant); }
.kpi-item:active { transform: scale(0.97); }
.kpi-item__label { font-size: var(--fs-xs); font-weight: 600; color: var(--c-on-surface-secondary); margin-bottom: var(--sp-1); text-transform: uppercase; }
.kpi-item__value { font-size: var(--fs-base); font-weight: 800; }
.kpi-item__comparison { font-size: var(--fs-xs); font-weight: 500; margin-top: var(--sp-1); height: 14px; }
.kpi-resaltado-azul { color: #00BFFF !important; text-shadow: 0 0 8px rgba(0, 122, 255, 0.7); }

/* Widget Colchón y FI */
.budget-item__progress { width: 100%; -webkit-appearance: none; appearance: none; height: 6px; border-radius: 99px; overflow: hidden; background-color: var(--c-surface-variant); }
.budget-item__progress::-webkit-progress-bar { background-color: var(--c-surface-variant); }
.budget-item__progress::-webkit-progress-value { background-color: var(--c-primary); transition: width 0.3s ease; }
.budget-item__progress.budget-item__progress--danger::-webkit-progress-value { background-color: var(--c-danger); }
.budget-item__progress.budget-item__progress--warning::-webkit-progress-value { background-color: var(--c-warning); }

/* Widget Config */
.widget-config-item { display: flex; align-items: center; gap: var(--sp-3); padding: var(--sp-2); background-color: var(--c-surface-variant); border-radius: var(--border-radius-md); margin-bottom: var(--sp-2); border: 1px solid var(--c-outline); }
.widget-config-item.dragging { opacity: 0.5; background-color: var(--c-primary); }
.widget-config-item__details { flex-grow: 1; }
.widget-config-item__title { font-weight: 700; color: var(--c-on-surface); }
.widget-config-item__desc { font-size: var(--fs-xs); color: var(--c-on-surface-secondary); }
.drag-handle { cursor: grab; color: var(--c-on-surface-tertiary); }
.drag-handle:active { cursor: grabbing; }

/* Widget Loading */
.widget-container { position: relative; }
.widget--loading::after { content: ''; position: absolute; inset: 0; background-color: var(--c-surface); opacity: 0.7; border-radius: var(--border-radius-lg); z-index: 10; transition: opacity 0.2s ease-in-out; }
.widget-spinner { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 11; }

/* ================================================================= */
/* === PÁGINAS: PATRIMONIO, INFORMES Y AJUSTES                    === */
/* ================================================================= */

/* Patrimonio */
.patrimonio-header-grid { display: flex; flex-direction: column; gap: var(--sp-4); padding: var(--sp-4); margin-bottom: var(--sp-4); }
.patrimonio-header-grid__filters .kpi-item__label { margin-bottom: var(--sp-3); font-weight: 600; }

.portfolio-summary-card { background-color: var(--c-surface-variant); border: 1px solid var(--c-outline); border-radius: var(--border-radius-lg); padding: var(--sp-4); margin-top: var(--sp-4); }
.portfolio-summary-card__title { font-size: var(--fs-base); font-weight: 700; color: var(--c-on-surface-secondary); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: var(--sp-4); display: flex; align-items: center; gap: var(--sp-2); }
.portfolio-summary-card__grid { display: flex; justify-content: space-around; text-align: center; gap: var(--sp-3); }
.summary-kpi__label { font-size: var(--fs-sm); font-weight: 600; color: var(--c-on-surface-secondary); margin-bottom: var(--sp-1); }
.summary-kpi__value { font-size: var(--fs-xl); font-weight: 800; line-height: 1.2; }

.portfolio-asset-card { display: flex; align-items: center; gap: var(--sp-3); padding: var(--sp-3) var(--sp-2); cursor: pointer; border-bottom: 1px solid var(--c-outline); transition: background-color 0.2s; }
.portfolio-asset-card:hover { background-color: var(--c-surface-variant); }
.asset-card__details { flex-grow: 1; min-width: 0; }
.asset-card__name { font-weight: 700; color: var(--c-on-surface); }
.asset-card__allocation { font-size: var(--fs-xs); font-weight: 600; color: var(--c-on-surface-secondary); }
.asset-card__figures { flex-shrink: 0; text-align: right; }
.asset-card__value { font-weight: 700; font-size: var(--fs-base); }
.asset-card__pnl-pill { display: inline-block; padding: 3px 8px; font-size: 0.7rem; font-weight: 700; border-radius: 99px; margin-top: 4px; color: var(--c-white); }
.asset-card__pnl-pill.is-positive { background-color: #006434; }
.asset-card__pnl-pill.is-negative { background-color: #991410; }
.asset-card__valoracion-btn { background-color: var(--c-surface-variant); color: var(--c-on-surface-secondary); border: 1px solid var(--c-outline); padding: 3px 8px; font-size: 0.7rem; font-weight: 600; border-radius: 99px; cursor: pointer; transition: all 0.2s; display: inline-flex; align-items: center; gap: 4px; }
.asset-card__valoracion-btn:hover { background-color: var(--c-surface); color: var(--c-primary); }
.asset-card__valuation-area { display: flex; align-items: center; justify-content: flex-end; gap: var(--sp-2); margin-top: 6px; }
.asset-card__last-valuation-date { font-size: 0.7rem; font-weight: 600; color: var(--c-on-surface-secondary); white-space: nowrap; }

/* Informes (Extracto de Cuenta) */
.informe-extracto-container { border: 1px solid var(--c-outline); border-radius: var(--border-radius-lg); overflow: hidden; }
.informe-linea-header, .informe-linea-saldo-inicial, .informe-linea-resumen { display: flex; justify-content: space-between; align-items: center; padding: var(--sp-2) var(--sp-3); font-size: var(--fs-xs); }
.informe-linea-header { font-weight: 700; color: var(--c-on-surface-secondary); background-color: var(--c-surface-variant); text-transform: uppercase; }
.informe-linea-saldo-inicial, .informe-linea-resumen { font-weight: 600; color: var(--c-on-surface-secondary); background-color: var(--c-surface-variant); border-top: 1px solid var(--c-outline); }
.informe-linea-resumen { background-color: transparent; font-style: italic; }
.informe-linea-movimiento { display: flex; justify-content: space-between; align-items: center; padding: var(--sp-3); border-top: 1px solid var(--c-outline); }
.informe-linea-movimiento__main { flex: 1; min-width: 0; display: flex; align-items: center; gap: var(--sp-3); }
.informe-linea-movimiento__fecha { font-weight: 600; font-size: var(--fs-sm); color: var(--c-on-surface-secondary); width: 65px; }
.informe-linea-movimiento__details { min-width: 0; }
.informe-linea-movimiento__descripcion { font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.informe-linea-movimiento__concepto { font-size: var(--fs-xs); color: var(--c-on-surface-tertiary); display: none; }
.informe-linea-movimiento__figures, .informe-linea-header, .informe-linea-saldo-inicial, .informe-linea-resumen { font-family: monospace, sans-serif; }
.informe-linea-movimiento__figures { text-align: right; }
.informe-linea-movimiento__importe { font-weight: 700; font-size: 1.05em; }
.informe-linea-movimiento__saldo { font-size: var(--fs-xs); color: var(--c-on-surface-secondary); }

.informe-linea-resumen .descripcion { flex-grow: 1; flex-shrink: 1; min-width: 0; text-align: right; font-style: italic; color: var(--c-on-surface-secondary); padding-right: var(--sp-4); }
.informe-linea-resumen .importe, .informe-linea-resumen .saldo { width: 110px; text-align: right; font-family: monospace, sans-serif; font-size: 0.9em; }
.informe-linea-resumen .saldo { visibility: hidden; }

/* Ajustes */
.settings-group__title { font-size: var(--fs-sm); font-weight: 700; color: var(--c-on-surface-secondary); text-transform: uppercase; letter-spacing: 0.5px; padding: 0 var(--sp-4) var(--sp-2) var(--sp-4); margin-top: var(--sp-4); }
.settings-item { display: flex; align-items: center; gap: var(--sp-3); width: 100%; padding: var(--sp-3) var(--sp-4); border: none; background: var(--c-surface); text-align: left; cursor: pointer; border-bottom: 1px solid var(--c-outline); transition: background-color 0.2s ease-in-out; }
.card .settings-item:last-child { border-bottom: none; }
.settings-item:hover { background-color: var(--c-surface-variant); }
.settings-item .settings-item__label { flex-grow: 1; color: var(--c-on-surface); font-weight: 600; }
.settings-item .material-icons { color: var(--c-on-surface-secondary); }
.settings-item .text-positive { color: var(--c-success); }
.settings-item .text-warning { color: var(--c-warning); }
.settings-item .text-danger { color: var(--c-danger); }
.settings-item.text-danger .settings-item__label { color: var(--c-danger); }
.settings-item:active, .modal__list-item:active { background-color: var(--c-surface-variant); transform: scale(0.98); transition: transform 0.1s ease-out; }

/* Cartilla Bancaria Retro */
.cartilla-container { background-color: #fff; color: #000; font-family: 'Courier New', Courier, monospace; border: 1px solid #ccc; box-shadow: 2px 2px 0px rgba(0,0,0,0.1); padding: 20px; max-width: 800px; margin: 0 auto; font-size: 0.85rem; }
body[data-theme="default"] .cartilla-container { background-color: #e0e0e0; color: #1a1a1a; }
.cartilla-header-info { border-bottom: 2px dashed #444; margin-bottom: 15px; padding-bottom: 10px; }
.cartilla-header-info h4 { font-size: 1.2rem; margin-bottom: 5px; text-transform: uppercase; letter-spacing: 1px; color: #000; }
.cartilla-table { display: flex; flex-direction: column; width: 100%; }
.cartilla-row { display: grid; grid-template-columns: 70px 1fr 85px 85px 90px; gap: 10px; padding: 6px 4px; border-bottom: 1px dotted #bbb; align-items: baseline; }
.cartilla-row:last-child { border-bottom: 2px solid #000; }
.cartilla-head { font-weight: 800; border-bottom: 2px solid #000; padding-bottom: 8px; margin-bottom: 4px; }
.cartilla-cell { overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.cartilla-concept { white-space: normal; line-height: 1.1; font-size: 0.8rem; text-transform: uppercase; }
.cartilla-amount, .cartilla-balance { text-align: right; font-weight: 600; }
.text-debit { color: #a00; } .text-credit { color: #000; }
.cartilla-footer { text-align: center; margin-top: 20px; font-style: italic; font-size: 0.7rem; letter-spacing: 2px; }

/* ================================================================= */
/* === UTILIDADES Y OTROS                                         === */
/* ================================================================= */

/* Botones */
.btn { padding: var(--sp-3) var(--sp-4); border: 1px solid transparent; border-radius: var(--border-radius-md); font-size: var(--fs-sm); font-weight: 700; cursor: pointer; transition: all 0.2s, transform 0.1s ease-out; display: inline-flex; align-items: center; justify-content: center; gap: var(--sp-2); -webkit-user-select: none; user-select: none; }
.btn:active { transform: scale(0.98); opacity: 0.85; }
.btn--primary { background-color: var(--c-primary); color: var(--c-white); border-color: var(--c-primary); } .btn--primary:hover { background-color: var(--c-primary-hover); border-color: var(--c-primary-hover); box-shadow: var(--shadow-md); }
.btn--secondary { background-color: var(--c-surface-variant); color: var(--c-on-surface); border: 1px solid var(--c-outline); } .btn--secondary:hover { background-color: var(--c-outline); border-color: var(--c-on-surface-tertiary); }
.btn--danger { background-color: var(--c-danger); color: var(--c-white); } .btn--danger:hover { box-shadow: var(--glow-red); }
.btn--full { width: 100%; } .btn--loading { pointer-events: none; opacity: .8; }
.icon-btn { background: none; border: none; color: var(--c-on-surface-secondary); cursor: pointer; width: 36px; height: 36px; display: inline-flex; align-items: center; justify-content: center; border-radius: 50%; transition: background-color 0.2s, color 0.2s, transform 0.2s; }
.icon-btn .material-icons { font-size: 20px; }
.icon-btn:hover { background-color: var(--c-surface-variant); color: var(--c-primary); }
.icon-btn:active { transform: scale(0.9); }

/* Login */
.login-view { position: fixed; inset: 0; z-index: 1040; display: none; flex-direction: column; justify-content: center; align-items: center; padding: var(--sp-4); opacity: 0; transition: opacity .5s; background-color: transparent; }
.login-view--visible { display: flex; opacity: 1; }
.login-view__card { padding: var(--sp-6) var(--sp-5); max-width: 380px; z-index: 10; text-align: center; animation: pop-in 0.3s ease-out; }
.login-view__logo { max-width: 90px; height: auto; border-radius: 18px; margin-bottom: var(--sp-4); box-shadow: 0 0 25px rgba(255, 255, 255, 0.1); }
.login-view__tagline { font-size: var(--fs-base); color: var(--c-on-surface-secondary); margin-bottom: var(--sp-5); }
.pin-inputs { display: flex; justify-content: center; gap: 12px; margin: 2rem 0; }
.pin-input { width: 50px; height: 60px; font-size: 2rem; text-align: center; border: 2px solid var(--c-outline); border-radius: var(--border-radius-md); background-color: var(--c-surface-variant); color: var(--c-on-surface); caret-color: var(--c-primary); transition: border-color 0.2s, box-shadow 0.2s; }
.pin-input:focus { outline: none; border-color: var(--c-primary); box-shadow: var(--shadow-md); }

/* Helpers */
.text-positive { color: var(--c-success); } .text-negative { color: var(--c-danger); } .text-warning { color: var(--c-warning); } .text-info { color: var(--c-info); } .text-gasto { color: var(--c-danger); } .text-ingreso { color: var(--c-success); }
.hidden { display: none !important; }
.spinner { display: inline-block; width: 1em; height: 1em; border: .15em solid currentColor; border-radius: 50%; border-top-color: transparent; animation: spin .8s linear infinite; vertical-align: middle; }
@keyframes spin { to { transform:rotate(360deg); } }
.visually-hidden { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border: 0; }
.empty-state { text-align: center; padding: var(--sp-5) 0; color: var(--c-on-surface-secondary); animation: fade-in 0.3s; border-radius: var(--border-radius-lg); }
.empty-state .material-icons { font-size: 40px; margin-bottom: var(--sp-2); color: var(--c-primary); }
.empty-state h3 { font-size: var(--fs-lg); font-weight: 700; color: var(--c-on-surface); margin-bottom: var(--sp-2); }

/* Búsqueda Global */
#global-search-results { padding-top: var(--sp-2); }
.search-result-group { margin-bottom: var(--sp-5); }
.search-result-group__title { font-size: var(--fs-xs); font-weight: 700; color: var(--c-on-surface-secondary); text-transform: uppercase; letter-spacing: 0.5px; padding: 0 var(--sp-4) var(--sp-2) var(--sp-4); border-bottom: 1px solid var(--c-outline); margin-bottom: var(--sp-2); }
.search-result-item { display: flex; align-items: center; gap: var(--sp-4); width: 100%; padding: var(--sp-3) var(--sp-4); border: none; background: none; text-align: left; cursor: pointer; border-radius: var(--border-radius-md); transition: background-color 0.2s ease-in-out; }
.search-result-item:hover { background-color: var(--c-surface-variant); }
.search-result-item__icon { flex-shrink: 0; width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; background-color: var(--c-surface-variant); color: var(--c-primary); }
.search-result-item__details { flex-grow: 1; min-width: 0; }
.search-result-item__details p { font-weight: 600; color: var(--c-on-surface); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin: 0; }
.search-result-item__details small { color: var(--c-on-surface-secondary); font-size: var(--fs-xs); }
.search-result-item__amount { font-weight: 700; font-size: var(--fs-base); white-space: nowrap; }

/* Pull to Refresh */
#pull-to-refresh-indicator { position: absolute; top: 44px; left: 0; right: 0; z-index: 10; display: flex; justify-content: center; padding: 10px; opacity: 0; transform: translateY(-50px); transition: opacity 0.3s, transform 0.3s; }
#pull-to-refresh-indicator.visible { opacity: 1; transform: translateY(0); }
#pull-to-refresh-indicator .spinner { width: 24px; height: 24px; border-width: 3px; color: var(--c-primary); }

/* Toast */
.toast-container { position: fixed; bottom: 70px; left: 50%; transform: translateX(-50%); z-index: 9999; display: flex; flex-direction: column; align-items: center; gap: var(--sp-2); pointer-events: none;}
.toast { background-color: var(--c-surface); color: var(--c-white); padding: var(--sp-2) var(--sp-4); border-radius: var(--border-radius-md); box-shadow: 0 0 20px rgba(0,0,0,0.5); pointer-events: all; border: 1px solid var(--c-outline); }

/* Calendario */
.calendar-container { padding: 0 var(--sp-4); }
.calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--sp-3); }
.calendar-header__title { font-size: var(--fs-lg); font-weight: 700; }
.calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; }
.calendar-weekday { text-align: center; font-size: var(--fs-xs); font-weight: 600; color: var(--c-on-surface-tertiary); margin-bottom: var(--sp-2); }
.calendar-day { display: flex; flex-direction: column; justify-content: flex-start; align-items: center; background-color: var(--c-surface); border: 1px solid var(--c-outline); border-radius: var(--border-radius-md); aspect-ratio: 1 / 1; min-height: 50px; cursor: pointer; transition: background-color 0.2s, transform 0.2s, border-color 0.2s; position: relative; }
.calendar-day:hover { background-color: var(--c-surface-variant); border-color: var(--c-primary); transform: scale(1.05); }
.calendar-day.empty { background-color: transparent; border: none; cursor: default; }
.calendar-day__number { font-size: var(--fs-xs); font-weight: 600; padding-top: var(--sp-1); }
.calendar-day.is-today .calendar-day__number { color: var(--c-white); background-color: var(--c-primary); border-radius: 50%; width: 1.5em; height: 1.5em; display: inline-flex; justify-content: center; align-items: center; }
.calendar-day__total { font-size: 0.65rem; font-weight: 700; text-align: center; margin-top: auto; padding: 2px 4px; border-radius: 4px; width: 90%; margin-bottom: 2px; }
.calendar-day__markers { display: flex; gap: 3px; position: absolute; bottom: 4px; left: 50%; transform: translateX(-50%); }
.calendar-day__marker { width: 5px; height: 5px; border-radius: 50%; }
.marker--income { background-color: var(--c-success); }
.marker--expense { background-color: var(--c-danger); }

/* Calculadora */
#calculator-overlay { z-index: 2147483647 !important; }
.calculator-ui { position: fixed; bottom: 0; left: 50%; transform: translateX(-50%) translateY(100%); width: 100%; max-width: 420px; z-index: 10; background-color: var(--c-surface-variant); border-top: 1px solid var(--c-outline); padding: var(--sp-3); padding-bottom: calc(var(--sp-3) + env(safe-area-inset-bottom)); border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0; box-shadow: 0 -5px 20px rgba(0,0,0,0.3); transition: transform 0.35s cubic-bezier(0.4, 0, 0.2, 1); visibility: hidden; }
#calculator-overlay.modal-overlay--active .calculator-ui { transform: translateX(-50%) translateY(0); visibility: visible; }
.calculator-display { font-size: 2.1rem; font-weight: 300; text-align: right; padding: var(--sp-1) var(--sp-3); margin-bottom: var(--sp-3); min-height: 48px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.calculator-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; }
.calculator-btn { font-family: var(--font-family); font-size: 1.2rem; font-weight: 500; height: 48px; border-radius: var(--border-radius-md); border: none; background-color: var(--c-surface); color: var(--c-on-surface); cursor: pointer; display: flex; align-items: center; justify-content: center; transition: background-color 0.2s, transform 0.1s; }
.calculator-btn:active { transform: scale(0.95); }
.calculator-btn.btn-operator { color: var(--c-primary); }
.calculator-btn.btn-confirm { background-color: var(--c-primary); color: var(--c-white); }
.calculator-btn.zero { grid-column: span 2; }
.material-icons.backspace-icon { font-size: 1.2rem; }
.calculator-history-display { font-size: 1.1rem; font-weight: 500; color: var(--c-on-surface-secondary); text-align: right; padding: 0 var(--sp-3); min-height: 22px; margin-bottom: var(--sp-1); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.calculator-btn.btn-operator--active { background-color: var(--c-primary); color: var(--c-white); }
.input-amount-calculator { caret-color: transparent; cursor: pointer; user-select: none; -webkit-user-select: none; background-color: var(--c-surface-variant) !important; }

/* Sincronización */
#sync-status-icon { font-size: 20px; transition: color 0.3s ease-in-out, transform 0.3s ease; }
.sync-status--synced { color: var(--c-success); transform: scale(1.1); }
.sync-status--syncing .sync-icon-spinner { animation: spin 1.2s linear infinite; }
.sync-status--error { color: var(--c-danger); }

/* Wizard JSON/CSV */
#json-drop-zone, .csv-converter-modal .upload-area { border: 2px dashed var(--c-outline); border-radius: var(--border-radius-lg); padding: 2.5rem; text-align: center; cursor: pointer; transition: border-color 0.3s, background-color 0.3s; margin-bottom: 1.5rem; }
#json-drop-zone.drag-over, .csv-converter-modal .upload-area.drag-over { border-color: var(--c-primary); background-color: color-mix(in srgb, var(--c-primary) 10%, transparent); }
#json-preview-list { list-style: none; padding-left: 0; }
#json-preview-list li { background-color: var(--c-surface-variant); padding: var(--sp-3); border-radius: var(--border-radius-md); margin-bottom: var(--sp-2); display: flex; align-items: center; gap: var(--sp-3); }
#json-preview-list .material-icons { color: var(--c-success); }

/* Filtro Diario Activo */
#diario-filter-active-indicator { background-color: color-mix(in srgb, var(--c-primary) 20%, transparent); padding: var(--sp-2) var(--sp-4); margin: var(--sp-4) var(--sp-4) 0 var(--sp-4); border-radius: var(--border-radius-md); text-align: center; border: 1px solid var(--c-primary); display: flex; justify-content: space-between; align-items: center; }
#diario-filter-active-indicator p { margin: 0; font-size: var(--fs-sm); font-weight: 500; display: flex; gap: 8px; }
#diario-filter-active-indicator button { background: none; border: none; color: var(--c-primary); text-decoration: underline; font-weight: 700; cursor: pointer; }

/* Pestañas (Tabs) */
.tabs { display: flex; gap: var(--sp-2); border-bottom: 2px solid var(--c-outline); margin-bottom: var(--sp-4); padding: 0 var(--sp-2); }
.tab-item { flex: 1; padding: var(--sp-2) var(--sp-1); background: none; border: none; border-bottom: 3px solid transparent; color: var(--c-on-surface-secondary); font-weight: 600; cursor: pointer; transition: all 0.2s ease-in-out; display: flex; flex-direction: column; align-items: center; gap: 4px; }
.tab-item:hover { color: var(--c-on-surface); background-color: var(--c-surface-variant); }
.tab-item--active { color: var(--c-primary); border-bottom-color: var(--c-primary); }
.tab-content { display: none; flex-direction: column; gap: var(--sp-4); }
.tab-content--active { display: flex; }

/* Acordeón */
.accordion { margin-bottom: 0; background-color: var(--c-surface); overflow: hidden; }
.accordion-wrapper > .accordion:first-child { border-top-left-radius: var(--border-radius-lg); border-top-right-radius: var(--border-radius-lg); }
.accordion-wrapper > .accordion:last-child { border-bottom-left-radius: var(--border-radius-lg); border-bottom-right-radius: var(--border-radius-lg); }
.accordion-wrapper > .accordion:not(:last-child) { border-bottom: 1px solid var(--c-outline); border-radius: 0; }
.accordion[open] > summary { border-bottom: 1px solid var(--c-outline); }
.accordion > summary { font-weight: 700; cursor: pointer; padding: var(--sp-3) var(--sp-4); display: flex; align-items: center; justify-content: space-between; list-style: none; font-size: var(--fs-base); }
.accordion > summary::-webkit-details-marker { display: none; }
.accordion > summary .accordion__icon { transition: transform 0.2s; color: var(--c-on-surface-secondary); }
.accordion[open] > summary .accordion__icon { transform: rotate(180deg); }
.accordion__content { padding: 0 var(--sp-4) var(--sp-4) var(--sp-4); }

/* Inicio y Intro */
.intro-screen { position: fixed; inset: 0; z-index: 9999; display: flex; justify-content: center; align-items: center; background-color: #000000; transition: opacity 0.75s ease-in-out; }
.starry-background { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-image: radial-gradient(1px 1px at 10% 20%,#fff,transparent),radial-gradient(1px 1px at 80% 30%,#fff,transparent),radial-gradient(2px 2px at 50% 50%,#fff,transparent),radial-gradient(1px 1px at 30% 80%,#fff,transparent),radial-gradient(2px 2px at 90% 90%,#fff,transparent); background-size: 300px 300px; animation: twinkle 15s linear infinite; }
@keyframes twinkle { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
#exit-screen { display: none; opacity: 0; position: fixed; inset: 0; background-color: var(--c-background); color: var(--c-on-surface); flex-direction: column; align-items: center; justify-content: center; z-index: 9999; font-size: 1.5rem; text-align: center; transition: opacity 0.5s ease; }

/* ================================================================= */
/* === MEDIA QUERIES (Responsividad)                              === */
/* ================================================================= */

/* Dispositivos Móviles (< 480px) */
@media (max-width: 480px) {
    .view { padding: 0 var(--sp-2); }
    .card__content { padding: var(--sp-2); }
    .card__title { padding: var(--sp-3) var(--sp-2) 0 var(--sp-2); }
    #inversiones-page .card__content { flex-direction: column; gap: var(--sp-3); align-items: center; }
    .kpi-grid, .form-grid { grid-template-columns: 1fr !important; gap: var(--sp-2); }
    #custom-date-filters.form-grid { grid-template-columns: 1fr !important; }
    
    /* Ajustes Top Bar */
    .top-bar__left-button { flex-shrink: 1; min-width: 0; flex-grow: 1; }
    #page-title-display { display: none; }
    .top-bar__left-group { gap: var(--sp-1); }
    .top-bar__actions { gap: 0; }
    .top-bar .top-bar__actions .icon-btn { width: 38px; height: 38px; }
    .top-bar .top-bar__actions .icon-btn .material-icons { font-size: 22px; }

    /* Informe Extracto (Móvil) */
    .informe-linea-header, .informe-linea-saldo-inicial .saldo, .informe-linea-resumen .importe { display: none; }
    .informe-extracto-container { border: none; }
    .informe-linea-movimiento, .informe-linea-saldo-inicial, .informe-linea-resumen { padding-left: var(--sp-2); padding-right: var(--sp-2); }
    .informe-linea-movimiento { display: grid; grid-template-columns: 1fr auto; grid-template-rows: auto auto; padding: var(--sp-3); gap: 4px var(--sp-4); align-items: center; border-bottom: 1px solid var(--c-outline); }
    .informe-linea-movimiento__fecha { grid-column: 1; grid-row: 1; font-size: var(--fs-xs); width: auto; }
    .informe-linea-movimiento__descripcion { display: none; }
    .informe-linea-movimiento__concepto { display: block; grid-column: 1; grid-row: 2; }
    .informe-linea-movimiento__importe { grid-column: 2; grid-row: 1; font-size: 1.15em; }
    .informe-linea-movimiento__saldo { grid-column: 2; grid-row: 2; font-weight: 600; }
    .informe-linea-resumen .descripcion { flex: 1; text-align: center; font-size: 0.9em; }
    
    /* Cartilla Móvil */
    .cartilla-container { padding: 10px; font-size: 0.75rem; }
    .cartilla-row { grid-template-columns: 60px 1fr 75px; grid-template-areas: "date concept amount" "empty balance balance"; gap: 2px 8px; padding: 8px 2px; }
    .cartilla-head { display: none; }
    .cartilla-date { grid-area: date; font-weight: 700; }
    .cartilla-concept { grid-area: concept; max-height: 2.4em; overflow: hidden; }
    .cartilla-amount { grid-area: amount; font-size: 0.9rem; }
    .cartilla-balance { grid-area: balance; text-align: right; font-size: 0.7rem; color: #555; }
    .cartilla-balance::before { content: "Saldo: "; }
    .cartilla-cell:empty { display: none; }
}

/* Tablets y Escritorio */
@media (min-width: 768px) {
    .app-layout { max-width: 95%; }
    .top-bar, .bottom-nav { max-width: 100%; }
    .modal-overlay { align-items: center; }
    .modal { border-radius: var(--border-radius-lg); transform: translateY(0) scale(0.95); transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.3s; }
    .modal-overlay--active .modal { transform: translateY(0) scale(1); }
    .view { padding: 0 var(--sp-5); }
    .kpi-grid { grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: var(--sp-4); }
    .form-grid { grid-template-columns: 1fr 1fr; }
    .patrimonio-header-grid { flex-direction: row; align-items: flex-start; }
    .patrimonio-header-grid__kpi { flex: 1; min-width: 220px; }
    .patrimonio-header-grid__filters { flex: 3; padding-left: var(--sp-4); border-left: 1px solid var(--c-outline); }
    
    /* Fix iOS Zoom */
    input, select, textarea { font-size: 16px !important; }
}

@media (min-width: 1024px) {
    body { overflow-y: auto; }
    .app-layout { flex-direction: row; max-width: 100%; height: 100vh; }
    .bottom-nav { position: fixed; flex-direction: column; width: 240px; height: 100vh; left: 0; top: 0; transform: none; border-top: none; border-right: 1px solid var(--c-outline); padding: var(--sp-5) var(--sp-3); justify-content: flex-start; gap: var(--sp-2); box-shadow: none; background-color: var(--c-background); }
    .bottom-nav__item { flex: 0 0 auto; flex-direction: row; justify-content: flex-start; width: 100%; height: auto; padding: var(--sp-2) var(--sp-3); border-radius: var(--border-radius-md); }
    .bottom-nav__item:hover { background-color: var(--c-surface-variant); }
    body[data-ledger-mode="A"] .bottom-nav__item--active { background-color: var(--c-primary); color: var(--c-white); }
    body[data-ledger-mode="B"] .bottom-nav__item--active { background-color: var(--c-danger); color: var(--c-white) !important; }
    body[data-ledger-mode="A"] .bottom-nav__item--active:hover { background-color: var(--c-primary-hover); }
    body[data-ledger-mode="B"] .bottom-nav__item--active:hover { background-color: color-mix(in srgb, var(--c-danger) 80%, white); }
    .bottom-nav__item .material-icons { margin-right: var(--sp-3); font-size: 20px; }
    .bottom-nav__label { display: inline-block; font-size: var(--fs-sm); font-weight: 600; margin-top: 0; }
    .app-layout__main { margin-left: 240px; width: calc(100% - 240px); height: 100vh; padding: 60px var(--sp-6) var(--sp-6) var(--sp-6); }
    .view { max-width: 1100px; margin: 0 auto; padding: 0; }
    .top-bar { max-width: none; width: calc(100% - 240px); left: auto; right: 0; transform: none; padding-left: var(--sp-6); padding-right: var(--sp-6); }
    .toast-container { bottom: var(--sp-4); left: auto; right: calc(240px / 2); transform: translateX(50%); }
    .fab-container, #bottom-nav-add-btn { display: none !important; }
}

/* FIX iOS Input Zoom */
@media screen and (-webkit-min-device-pixel-ratio: 0) { 
    select:focus, textarea:focus, input:focus { font-size: 16px !important; }
}