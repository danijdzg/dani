/* ================================================================= */
/* === 1. VARIABLES Y TEMAS (THEMING)                            === */
/* ================================================================= */
:root {
    /* TEMA BASE: "ABISMO DIGITAL" (Oscuro) */
    --c-primary: #00B34D;
    --c-primary-hover: #00CC55;
    --c-danger: #FF3B30;
    --c-success: #39FF14;
    --c-warning: #FFD60A;
    --c-info: #BF5AF2;
    
    --c-background: #0A121A;
    --c-surface: rgba(28, 42, 58, 0.6);
    --c-surface-variant: rgba(42, 58, 78, 0.5);
    
    --c-outline: rgba(255, 255, 255, 0.1);
    --c-border-glow: 0 0 12px rgba(0, 179, 77, 0.4);
    
    --c-on-surface: #F0F8FF;
    --c-on-surface-secondary: rgba(240, 248, 255, 0.85);
    --c-on-surface-tertiary: rgba(240, 248, 255, 0.70);
    
    --c-white: #FFFFFF; 
    --c-black: #000000;
    --c-chart-positive: var(--c-success); 
    --c-chart-negative: var(--c-danger);

    --shadow-sm: 0 0 8px rgba(0, 0, 0, 0.25);
    --shadow-md: 0 0 20px rgba(0, 0, 0, 0.45);
    --glow-red: 0 0 20px rgba(255, 59, 48, 0.55);

    --font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
    --fs-xs: 0.75rem; --fs-sm: 0.875rem; --fs-base: 1rem; --fs-lg: 1.125rem; --fs-xl: 1.25rem;
    --sp-1: 0.25rem; --sp-2: 0.5rem; --sp-3: 0.75rem; --sp-4: 1rem; --sp-5: 1.25rem; --sp-6: 1.5rem;
    --border-radius-md: 10px; --border-radius-lg: 16px;
}

body[data-theme="sunset-groove"] {
    /* TEMA 2: "BRISA ALPINA" (Claro) */
    --c-primary: #007AFF;
    --c-primary-hover: #0056b3;
    --c-danger: #D92A2A;
    --c-success: #28a745;
    --c-warning: #FF9500;
    --c-info: #5856D6;
    
    --c-background: #F7F7F7;
    --c-surface: rgba(255, 255, 255, 0.8);
    --c-surface-variant: rgba(255, 255, 255, 0.7);
    --c-outline: rgba(60, 60, 67, 0.12);
    
    --c-on-surface: #1D1D1F;
    --c-on-surface-secondary: #3C3C4399;
    --c-on-surface-tertiary: #3C3C4380;
    
    --shadow-sm: 0 4px 15px rgba(0, 0, 0, 0.06);
    --shadow-md: 0 8px 30px rgba(0, 0, 0, 0.12);
}

/* ================================================================= */
/* === 2. BASE Y RESET                                           === */
/* ================================================================= */
* { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
html { height: -webkit-fill-available; scroll-behavior: smooth; }
body { 
    font-family: var(--font-family); 
    background-color: var(--c-background); 
    color: var(--c-on-surface); 
    line-height: 1.4; 
    min-height: 100vh; 
    min-height: -webkit-fill-available; 
    -webkit-font-smoothing: antialiased; 
    overflow: hidden; 
    font-weight: 500; 
}
*:focus-visible { outline: 2px solid var(--c-primary); outline-offset: 2px; border-radius: var(--sp-2); }

/* ================================================================= */
/* === 3. ESTRUCTURA APP (Layout, TopBar, Nav)                   === */
/* ================================================================= */
.app-layout { display: none; max-width: 500px; margin: 0 auto; height: 100vh; background-color: var(--c-background); flex-direction: column; opacity: 0; transition: opacity 0.5s ease-out, transform 0.4s cubic-bezier(0.4, 0, 0.2, 1), border-radius 0.4s; }
.app-layout--visible { display: flex; opacity: 1; }
.app-layout__main { flex: 1; overflow-y: auto; -webkit-overflow-scrolling: touch; padding: 44px 0 48px 0; }
.view { display: none; flex-direction: column; width: 100%; padding: 0 var(--sp-4); gap: var(--sp-4); }
.view--active { display: flex; }

/* --- Top Bar --- */
.top-bar {
    display: flex; align-items: center; justify-content: space-between; 
    padding: var(--sp-2) var(--sp-4); 
    background-color: rgba(28, 42, 58, 0.75);
    backdrop-filter: blur(20px) saturate(180%);
    -webkit-backdrop-filter: blur(20px) saturate(180%);
    border-top: 1px solid rgba(255, 255, 255, 0.15);
    border-bottom: 1px solid var(--c-outline); 
    z-index: 200; height: 44px; position: fixed; top: 0; left: 50%; transform: translateX(-50%); width: 100%; max-width: 500px; transition: background-color 0.3s ease-in-out;
}
/* Estilos específicos Contabilidad A/B en Top Bar */
body[data-ledger-mode="A"] .top-bar { background-color: rgba(0, 45, 91, 0.85); }
body[data-ledger-mode="B"] .top-bar { background-color: rgba(91, 0, 0, 0.85); }

.top-bar__title { font-size: var(--fs-lg); font-weight: 800; padding-left: var(--sp-2); text-align: center; }
#page-title-display { font-size: var(--fs-base); font-weight: 700; margin-left: var(--sp-3); color: var(--c-white); white-space: nowrap; text-decoration: none; }
.top-bar__actions { display: flex; align-items: center; gap: 0; }
.top-bar__left-button { min-width: 85px; display: flex; align-items: center; }
.top-bar__left-group { display: flex; align-items: center; gap: var(--sp-3); }

/* Botones e Iconos Top Bar */
.top-bar .icon-btn { width: 40px; height: 40px; transition: transform 0.2s; color: var(--c-white); }
.top-bar .icon-btn[data-action="global-search"] .material-icons { color: var(--c-primary); font-weight: 600; }
.top-bar .icon-btn:hover .material-icons { transform: scale(1.1); }

/* Toggle Contabilidad */
#ledger-toggle-btn { font-weight: 700; padding: 6px 10px; font-size: 0.8rem; min-width: 40px; text-align: center; }
body[data-ledger-mode="A"] #ledger-toggle-btn { background-color: var(--c-primary); border-color: var(--c-primary); color: var(--c-white); box-shadow: 0 0 10px rgba(0, 122, 255, 0.5); }
body[data-ledger-mode="B"] #ledger-toggle-btn { background-color: var(--c-danger); border-color: var(--c-danger); color: var(--c-white); box-shadow: var(--glow-red); }

/* --- Bottom Nav --- */
.bottom-nav { 
    align-items: flex-end; position: fixed; bottom: 0; left: 50%; transform: translateX(-50%); width: 100%; max-width: 500px; 
    background-color: var(--c-surface); border-top: 1px solid var(--c-outline); display: flex; padding-bottom: env(safe-area-inset-bottom); 
    z-index: 200; box-shadow: 0 -2px 15px rgba(0,0,0,0.2); height: 48px; 
}
.bottom-nav__item { 
    flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; 
    padding: var(--sp-1) var(--sp-2); cursor: pointer; transition: color 0.2s; 
    color: var(--c-on-surface-secondary); border: none; background: none; 
}
.bottom-nav__item--active { color: var(--c-primary); }
body[data-ledger-mode="B"] .bottom-nav__item--active { color: var(--c-danger) !important; }
.bottom-nav__item .material-icons { font-size: 22px; } 
.bottom-nav__label { display: none; font-size: var(--fs-xs); margin-top: 2px; }

/* Botón Central Flotante (FAB) */
#bottom-nav-add-btn {
    width: 56px; height: 56px; background-color: var(--c-primary); color: var(--c-white); border: none; border-radius: 50%; 
    display: flex; align-items: center; justify-content: center; margin-bottom: 12px; box-shadow: var(--shadow-md); 
    cursor: pointer; transition: all 0.2s ease-in-out;
}
#bottom-nav-add-btn:hover { transform: scale(1.1) rotate(15deg); background-color: var(--c-primary-hover); }
#bottom-nav-add-btn:active { transform: scale(0.95); }

/* ================================================================= */
/* === 4. COMPONENTES UI GENERALES                               === */
/* ================================================================= */

/* --- Tarjetas --- */
.card { background-color: var(--c-surface); border-radius: var(--border-radius-lg); border: 1px solid var(--c-outline); margin-bottom: var(--sp-4); overflow: hidden; }
.card__title { font-size: var(--fs-lg); font-weight: 700; margin-bottom: var(--sp-3); display: flex; align-items: center; gap: var(--sp-2); padding: var(--sp-4) var(--sp-4) 0 var(--sp-4); }
.card__content { padding: 0 var(--sp-4) var(--sp-4) var(--sp-4); }
.card--no-bg { background: none; border: none; box-shadow: none; padding: 0; border-radius: 0; }

/* --- Botones --- */
.btn { padding: var(--sp-3) var(--sp-4); border: 1px solid transparent; border-radius: var(--border-radius-md); font-size: var(--fs-sm); font-weight: 700; cursor: pointer; transition: all 0.2s, transform 0.1s ease-out; display: inline-flex; align-items: center; justify-content: center; gap: var(--sp-2); user-select: none; }
.btn:active { transform: scale(0.98); opacity: 0.85; }
.btn--primary { background-color: var(--c-primary); color: var(--c-white); border-color: var(--c-primary); }
.btn--primary:hover { background-color: var(--c-primary-hover); border-color: var(--c-primary-hover); box-shadow: var(--shadow-md); }
.btn--secondary { background-color: var(--c-surface-variant); color: var(--c-on-surface); border: 1px solid var(--c-outline); }
.btn--secondary:hover { background-color: var(--c-outline); }
.btn--danger { background-color: var(--c-danger); color: var(--c-white); }
.btn--full { width: 100%; } 
.btn--loading { pointer-events: none; opacity: .8; }
.icon-btn { background: none; border: none; color: var(--c-on-surface-secondary); cursor: pointer; width: 36px; height: 36px; display: inline-flex; align-items: center; justify-content: center; border-radius: 50%; transition: background-color 0.2s, color 0.2s, transform 0.2s; }
.icon-btn:hover { background-color: var(--c-surface-variant); color: var(--c-primary); }

/* --- Modales --- */
.modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.6); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); display: flex; align-items: flex-end; justify-content: center; z-index: 1050; opacity: 0; transition: opacity 0.3s ease-out; pointer-events: none; }
.modal-overlay--active { opacity: 1; pointer-events: auto; }
.app-layout--transformed-by-modal { transform: scale(0.92) translateY(-10px); border-radius: 20px; opacity: 0.8; transition: all 0.4s cubic-bezier(0.32, 0.72, 0, 1); }
.modal { background: var(--c-surface); border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0; padding: var(--sp-5); width: 100%; max-width: 420px; max-height: 90vh; display: flex; flex-direction: column; box-shadow: 0 0 30px rgba(0,0,0,0.5); transform: translateY(100%); transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
.modal-overlay--active .modal { transform: translateY(0); }
.modal__header { display: flex; align-items: center; justify-content: space-between; margin-bottom: var(--sp-3); flex-shrink: 0; }
.modal__title { font-size: var(--fs-xl); font-weight: 800; }
.modal__body { overflow-y: auto; flex-grow: 1; -webkit-overflow-scrolling: touch; padding-bottom: 0 !important; }
.modal__actions { margin-top: var(--sp-4); display: flex; justify-content: flex-end; gap: var(--sp-2); width: 100%; flex-shrink: 0; background-color: var(--c-surface); border-top: 1px solid var(--c-outline); padding: var(--sp-3) var(--sp-4); padding-bottom: calc(var(--sp-3) + env(safe-area-inset-bottom)); z-index: 10; position: relative; box-shadow: 0 -4px 20px rgba(0,0,0,0.2); }
.modal__grabber { width: 40px; height: 5px; background-color: var(--c-outline); border-radius: 99px; position: absolute; top: 8px; left: 50%; transform: translateX(-50%); }
.modal__list-item { display:flex; justify-content:space-between; align-items:center; padding: var(--sp-3) 0; border-bottom:1px solid var(--c-outline); gap: var(--sp-2); }

/* --- Acordeones --- */
.accordion { margin-bottom: 0; background-color: var(--c-surface); overflow: hidden; }
.accordion-wrapper > .accordion:first-child { border-top-left-radius: var(--border-radius-lg); border-top-right-radius: var(--border-radius-lg); }
.accordion-wrapper > .accordion:last-child { border-bottom-left-radius: var(--border-radius-lg); border-bottom-right-radius: var(--border-radius-lg); }
.accordion-wrapper > .accordion:not(:last-child) { border-bottom: 1px solid var(--c-outline); border-radius: 0; }
.accordion[open] > summary { border-bottom: 1px solid var(--c-outline); }
.accordion > summary { font-weight: 700; cursor: pointer; padding: var(--sp-3) var(--sp-4); display: flex; align-items: center; justify-content: space-between; list-style: none; font-size: var(--fs-base); }
.accordion > summary::-webkit-details-marker { display: none; }
.accordion__content { padding: 0 var(--sp-4) var(--sp-4) var(--sp-4); }

/* --- Tabs --- */
.tabs { display: flex; gap: var(--sp-2); border-bottom: 2px solid var(--c-outline); margin-bottom: var(--sp-4); padding: 0 var(--sp-2); }
.tab-item { flex: 1; padding: var(--sp-2) var(--sp-1); background: none; border: none; border-bottom: 3px solid transparent; color: var(--c-on-surface-secondary); font-weight: 600; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 4px; }
.tab-item--active { color: var(--c-primary); border-bottom-color: var(--c-primary); }
.tab-content { display: none; flex-direction: column; gap: var(--sp-4); }
.tab-content--active { display: flex; }

/* --- Formularios --- */
.form-group { margin-bottom: var(--sp-3); position: relative; }
.form-label { display: block; font-size: var(--fs-sm); font-weight: 600; margin-bottom: var(--sp-2); color: var(--c-on-surface-secondary); }
.form-input, .form-select { width: 100%; padding: var(--sp-3); border: 1px solid var(--c-outline); border-radius: var(--border-radius-md); background: var(--c-surface-variant); color: var(--c-on-surface); font-size: var(--fs-base); appearance: none; }
.form-input:focus, .form-select:focus { outline: none; border-color: var(--c-primary); background-color: var(--c-surface); }
.form-error { color: var(--c-danger); font-size: var(--fs-xs); margin-top: var(--sp-1); display: block; font-weight: 600; }
.form-input--invalid { border-color: var(--c-danger) !important; box-shadow: var(--glow-red) !important; background: #ffecec; }
.form-switch { position: relative; display: inline-block; width: 36px; height: 20px; }
.form-switch input { opacity: 0; width: 0; height: 0; }
.form-switch .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: var(--c-surface-variant); transition: .4s; border-radius: 34px; border: 1px solid var(--c-outline); }
.form-switch .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 2px; bottom: 1px; background-color: white; transition: .4s; border-radius: 50%; }
.form-switch input:checked + .slider { background-color: var(--c-success); border-color: var(--c-success); }
.form-switch input:checked + .slider:before { transform: translateX(16px); }

/* Formulario Ultra-Compacto */
.dense-form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 8px; }
#movimiento-cantidad-form-group { grid-column: 1 / -1; margin-bottom: 4px; }
#movimiento-fields, #traspaso-fields { display: contents; }
.form-field-compact:has(#movimiento-concepto), .form-field-compact:has(#movimiento-cuenta), 
.form-field-compact:has(#movimiento-cuenta-origen), .form-field-compact:has(#movimiento-cuenta-destino) { grid-column: span 1; }
.form-field-compact:has(#movimiento-descripcion) { grid-column: 1 / -1; }
.form-field-compact .input-wrapper { background-color: var(--c-surface-variant); border: 1px solid var(--c-outline); border-radius: var(--border-radius-md); display: flex; align-items: center; height: 50px; transition: border-color 0.2s; }
.form-field-compact input, .form-field-compact select, .custom-select__trigger { height: 100%; width: 100%; border: none; background: transparent; padding: 0 12px !important; font-size: 0.95rem; font-weight: 500; color: var(--c-on-surface); line-height: 50px; }
#movimiento-cantidad-form-group .input-wrapper { height: 60px; background-color: var(--c-surface); }
#movimiento-cantidad { font-size: 1.5rem !important; text-align: center; padding-top: 10px !important; font-weight: 800; }
#movimiento-cantidad-form-group.is-ingreso #movimiento-cantidad { color: var(--c-success); }
#movimiento-cantidad-form-group.is-gasto #movimiento-cantidad { color: var(--c-danger); }
#movimiento-cantidad-form-group.is-traspaso #movimiento-cantidad { color: var(--c-info); }

/* Select Personalizado */
.custom-select-wrapper { position: relative; width: 100%; }
.custom-select__trigger { position: relative; display: flex; align-items: center; min-height: 50px; cursor: pointer; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.custom-select-wrapper.is-open .input-wrapper { border-color: var(--c-primary); box-shadow: var(--c-border-glow); }
.custom-select__trigger::after { content: ''; position: absolute; right: 12px; top: 50%; margin-top: 4px; transform: translateY(-50%); border-left: 5px solid transparent; border-right: 5px solid transparent; border-top: 6px solid var(--c-on-surface-secondary); }
.custom-select__options { position: absolute; top: calc(100% + 4px); left: 0; right: 0; background-color: var(--c-surface); border: 1px solid var(--c-outline); border-radius: var(--border-radius-md); box-shadow: var(--shadow-md); z-index: 1070; max-height: 200px; overflow-y: auto; opacity: 0; visibility: hidden; transform: translateY(-10px); transition: opacity 0.2s ease, transform 0.2s ease; }
.custom-select-wrapper.is-open .custom-select__options { opacity: 1; visibility: visible; transform: translateY(0); }
.custom-select__option { padding: 10px 12px; color: var(--c-on-surface-secondary); font-weight: 500; cursor: pointer; display: flex; align-items: center; gap: 10px; border-bottom: 1px solid var(--c-outline); }
.custom-select__option:hover { background-color: var(--c-surface-variant); color: var(--c-on-surface); }
.custom-select__option.is-selected { background-color: var(--c-primary); color: var(--c-white); font-weight: 600; }

/* Chips & Pills */
.filter-pills { display: flex; flex-wrap: wrap; gap: 4px; margin-bottom: 8px; }
.filter-pill { padding: 4px 12px; border: 1px solid var(--c-outline); border-radius: 99px; font-size: 0.75rem; background-color: var(--c-surface-variant); color: var(--c-on-surface); cursor: pointer; height: 28px; line-height: 1; }
.filter-pill--active { background-color: var(--c-primary); color: var(--c-white); border-color: var(--c-primary); font-weight: 700; }
.filter-pill[data-type="gasto"].filter-pill--active { background-color: var(--c-danger); border-color: var(--c-danger); }
.filter-pill[data-type="ingreso"].filter-pill--active { background-color: var(--c-success); border-color: var(--c-success); }
.filter-pill[data-type="traspaso"].filter-pill--active { background-color: var(--c-info); border-color: var(--c-info); }

/* --- Lista de Movimientos Virtualizada --- */
#movimientos-list-container { position: relative; padding: 0 var(--sp-4); }
#virtual-list-sizer { position: relative; width: 100%; }
#virtual-list-content { position: absolute; top: 0; left: 0; width: 100%; }

/* Tarjeta Transacción */
.transaction-card { display: flex; align-items: flex-start; padding: var(--sp-2) 0; cursor: pointer; border-bottom: 1px solid var(--c-outline); min-height: 64px; transition: background-color 0.2s, transform 0.2s; }
.transaction-card:active, .transaction-card.is-pressing { transform: scale(0.96); background-color: var(--c-surface-variant); }
.transaction-card__indicator { width: 3px; align-self: stretch; border-radius: 99px; margin-right: var(--sp-2); flex-shrink: 0; }
.transaction-card__indicator--income { background-color: var(--c-success); }
.transaction-card__indicator--expense { background-color: var(--c-danger); }
.transaction-card__indicator--transfer { background-color: var(--c-info); }
.transaction-card__indicator--recurrent { background-color: var(--c-warning); }
.transaction-card__content { flex-grow: 1; display: flex; justify-content: space-between; align-items: center; min-width: 0; }
.transaction-card__details { flex-grow: 1; min-width: 0; padding-right: var(--sp-2); }
.transaction-card__row-1 { font-size: var(--fs-sm); font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.transaction-card__row-2 { font-size: var(--fs-xs); color: var(--c-on-surface-secondary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.transaction-card__figures { text-align: right; min-width: 80px; }
.transaction-card__amount { font-size: var(--fs-sm); font-weight: 700; display: block; }
.transaction-card__balance { font-size: 0.7rem; color: var(--c-on-surface-secondary); display: block; }

/* Swipe Actions */
.swipe-container { position: relative; overflow: hidden; }
.swipe-actions-container { position: absolute; top: 0; bottom: 0; display: flex; align-items: center; z-index: 1; }
.swipe-action-btn { width: 75px; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; color: var(--c-white); border: none; }
.swipe-action-btn.duplicate { background-color: #FF9500; right: 0; }
.swipe-action-btn.delete { background-color: var(--c-danger); right: 75px; }

/* --- KPIs y Gráficos --- */
.kpi-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: var(--sp-3); }
.kpi-item { border-radius: var(--border-radius-lg); padding: var(--sp-3); text-align: center; transition: background-color 0.2s; }
.kpi-item__label { font-size: var(--fs-xs); font-weight: 600; color: var(--c-on-surface-secondary); margin-bottom: var(--sp-1); text-transform: uppercase; }
.kpi-item__value { font-size: var(--fs-base); font-weight: 800; }
.kpi-item__comparison { font-size: var(--fs-xs); margin-top: var(--sp-1); }
.kpi-item[data-action]:hover { background-color: var(--c-surface-variant); cursor: pointer; }
.kpi-resaltado-azul { color: #00BFFF !important; text-shadow: 0 0 8px rgba(0, 122, 255, 0.7); }
.chart-container { position: relative; height: 220px; width: 100%; margin-bottom: var(--sp-4); }

/* --- Extracto de Cuenta (Cartilla v2.0) --- */
.informe-extracto-container { border: 1px solid var(--c-outline); border-radius: var(--border-radius-lg); overflow: hidden; }
.informe-linea-header, .informe-linea-saldo-inicial, .informe-linea-resumen { display: flex; justify-content: space-between; align-items: center; padding: var(--sp-2) var(--sp-3); font-size: var(--fs-xs); font-family: monospace; }
.informe-linea-header { font-weight: 700; color: var(--c-on-surface-secondary); background-color: var(--c-surface-variant); text-transform: uppercase; }
.informe-linea-movimiento { display: flex; justify-content: space-between; align-items: center; padding: var(--sp-3); border-top: 1px solid var(--c-outline); }
.informe-linea-movimiento__main { flex: 1; display: flex; align-items: center; gap: var(--sp-3); }
.informe-linea-movimiento__fecha { font-weight: 600; font-size: var(--fs-sm); color: var(--c-on-surface-secondary); width: 65px; }
.informe-linea-movimiento__figures { text-align: right; font-family: monospace; }
.informe-linea-movimiento__importe { font-weight: 700; font-size: 1.05em; }

/* --- Ajustes y Configuración --- */
.settings-group__title { font-size: var(--fs-sm); font-weight: 700; color: var(--c-on-surface-secondary); text-transform: uppercase; margin-top: var(--sp-4); padding: 0 var(--sp-4) var(--sp-2); }
.settings-item { display: flex; align-items: center; gap: var(--sp-3); width: 100%; padding: var(--sp-3) var(--sp-4); border: none; background: var(--c-surface); text-align: left; cursor: pointer; border-bottom: 1px solid var(--c-outline); }
.settings-item:last-child { border-bottom: none; }
.settings-item:hover { background-color: var(--c-surface-variant); }
.settings-item__label { flex-grow: 1; font-weight: 600; color: var(--c-on-surface); }
.widget-config-item { display: flex; align-items: center; gap: var(--sp-3); padding: var(--sp-2); background-color: var(--c-surface-variant); border-radius: var(--border-radius-md); margin-bottom: var(--sp-2); border: 1px solid var(--c-outline); }
.widget-config-item.dragging { opacity: 0.5; background-color: var(--c-primary); }

/* --- Utilidades --- */
.hidden { display: none !important; }
.text-positive { color: var(--c-success); }
.text-negative { color: var(--c-danger); }
.text-warning { color: var(--c-warning); }
.text-info { color: var(--c-info); }
.spinner { display: inline-block; width: 1em; height: 1em; border: .15em solid currentColor; border-radius: 50%; border-top-color: transparent; animation: spin .8s linear infinite; vertical-align: middle; }
@keyframes spin { to { transform:rotate(360deg); } }
.skeleton { background-color: var(--c-surface-variant); background-image: linear-gradient(90deg, var(--c-surface-variant), color-mix(in srgb, var(--c-outline) 20%, var(--c-surface-variant)), var(--c-surface-variant)); background-size: 200% 100%; animation: shimmer 1.5s infinite linear; border-radius: var(--sp-2); color: transparent !important; }
@keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }

/* Animación Guardado */
.save-animation-bubble { width: 20px; height: 20px; border-radius: 50%; position: fixed; z-index: 99999; opacity: 0; pointer-events: none; transition: transform 0.7s cubic-bezier(0.5, -0.5, 0.5, 1.5), opacity 0.7s; }
@keyframes highlight-field-success { 0% { background-color: color-mix(in srgb, var(--c-success) 20%, transparent); } 100% { background-color: transparent; } }
.field-highlighted { animation: highlight-field-success 1s ease-out; }

/* --- Pull to Refresh --- */
#pull-to-refresh-indicator { position: absolute; top: 44px; left: 0; right: 0; z-index: 10; display: flex; justify-content: center; padding: 10px; opacity: 0; transform: translateY(-50px); transition: opacity 0.3s, transform 0.3s; }
#pull-to-refresh-indicator.visible { opacity: 1; transform: translateY(0); }
#pull-to-refresh-indicator .spinner { width: 24px; height: 24px; border-width: 3px; color: var(--c-primary); }

/* --- Calculadora Flotante --- */
#calculator-overlay { z-index: 2147483647 !important; }
.calculator-ui { position: fixed; bottom: 0; left: 50%; transform: translateX(-50%) translateY(100%); width: 100%; max-width: 420px; z-index: 10; background-color: var(--c-surface-variant); border-top: 1px solid var(--c-outline); padding: var(--sp-3); padding-bottom: calc(var(--sp-3) + env(safe-area-inset-bottom)); border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0; box-shadow: 0 -5px 20px rgba(0,0,0,0.3); transition: transform 0.35s cubic-bezier(0.4, 0, 0.2, 1); visibility: hidden; }
#calculator-overlay.modal-overlay--active .calculator-ui { transform: translateX(-50%) translateY(0); visibility: visible; }
.calculator-display { font-size: 2.1rem; font-weight: 300; text-align: right; padding: var(--sp-1) var(--sp-3); margin-bottom: var(--sp-3); min-height: 48px; }
.calculator-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; }
.calculator-btn { font-size: 1.2rem; font-weight: 500; height: 48px; border-radius: var(--border-radius-md); border: none; background-color: var(--c-surface); color: var(--c-on-surface); cursor: pointer; }
.calculator-btn.btn-confirm { background-color: var(--c-primary); color: var(--c-white); }
.calculator-history-display { font-size: 1.1rem; font-weight: 500; color: var(--c-on-surface-secondary); text-align: right; padding: 0 var(--sp-3); min-height: 22px; margin-bottom: var(--sp-1); }

/* --- Menú Desplegable (Popover) --- */
.popover-menu { position: fixed; top: 52px; right: 12px; z-index: 1100; background-color: var(--c-surface-variant); border-radius: var(--border-radius-md); border: 1px solid var(--c-outline); box-shadow: var(--shadow-md); width: 220px; padding: var(--sp-2); opacity: 0; transform: translateY(-10px) scale(0.95); transition: opacity 0.2s, transform 0.2s; pointer-events: none; }
.popover-menu--visible { opacity: 1; transform: translateY(0) scale(1); pointer-events: auto; }
.popover-menu__item { display: flex; align-items: center; gap: var(--sp-3); width: 100%; padding: var(--sp-2) var(--sp-3); border-radius: 6px; border: none; background: none; cursor: pointer; text-align: left; font-size: var(--fs-sm); font-weight: 500; color: var(--c-on-surface); }
.popover-menu__item:hover { background-color: var(--c-surface); }
.popover-menu__item--danger { color: var(--c-danger); }

/* ================================================================= */
/* === 5. MEDIA QUERIES                                          === */
/* ================================================================= */

/* Pantallas Pequeñas (< 380px) */
@media (max-width: 380px) {
    .view { padding: 0 var(--sp-2); }
    .card__content { padding: var(--sp-2); }
    .kpi-grid, .form-grid { grid-template-columns: 1fr !important; gap: var(--sp-2); }
    .top-bar__left-button { flex-shrink: 1; min-width: 0; flex-grow: 1; }
    #page-title-display { display: none; }
    .top-bar .icon-btn { width: 38px; height: 38px; }
    
    /* Adaptación Informe Cuenta */
    .informe-linea-header, .informe-linea-saldo-inicial .saldo, .informe-linea-resumen .importe { display: none; }
    .informe-extracto-container { border: none; }
    .informe-linea-movimiento { display: grid; grid-template-columns: 1fr auto; grid-template-rows: auto auto; gap: 4px var(--sp-4); padding: var(--sp-3); align-items: center; }
    .informe-linea-movimiento .fecha { grid-column: 1; grid-row: 1; font-size: var(--fs-xs); }
    .informe-linea-movimiento .descripcion { display: none; } /* Ocultar larga */
    .informe-linea-movimiento .concepto { display: block; grid-column: 1; grid-row: 2; }
    .informe-linea-movimiento .importe { grid-column: 2; grid-row: 1; font-size: 1.15em; }
    .informe-linea-movimiento .saldo { grid-column: 2; grid-row: 2; font-size: var(--fs-xs); }
}

/* Tablets (>= 768px) */
@media (min-width: 768px) {
    .app-layout { max-width: 95%; }
    .modal { border-radius: var(--border-radius-lg); transform: translateY(0) scale(0.95); }
    .modal-overlay--active .modal { transform: translateY(0) scale(1); }
    .view { padding: 0 var(--sp-5); }
    .kpi-grid { grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: var(--sp-4); }
    .form-grid { grid-template-columns: 1fr 1fr; }
}

/* Escritorio (>= 1024px) */
@media (min-width: 1024px) {
    body { overflow-y: auto; }
    .app-layout { flex-direction: row; max-width: 100%; height: 100vh; }
    .bottom-nav { position: fixed; flex-direction: column; width: 240px; height: 100vh; left: 0; top: 0; transform: none; border-top: none; border-right: 1px solid var(--c-outline); padding: var(--sp-5) var(--sp-3); justify-content: flex-start; gap: var(--sp-2); box-shadow: none; background-color: var(--c-background); }
    .bottom-nav__item { flex: 0 0 auto; flex-direction: row; justify-content: flex-start; width: 100%; height: auto; padding: var(--sp-2) var(--sp-3); border-radius: var(--border-radius-md); }
    .bottom-nav__item:hover { background-color: var(--c-surface-variant); }
    .bottom-nav__item .material-icons { margin-right: var(--sp-3); font-size: 20px; }
    .bottom-nav__label { display: inline-block; font-size: var(--fs-sm); font-weight: 600; margin-top: 0; }
    .app-layout__main { margin-left: 240px; width: calc(100% - 240px); height: 100vh; padding: 60px var(--sp-6) var(--sp-6) var(--sp-6); }
    .view { max-width: 1100px; margin: 0 auto; padding: 0; }
    .top-bar { max-width: none; width: calc(100% - 240px); left: auto; right: 0; transform: none; padding-left: var(--sp-6); padding-right: var(--sp-6); }
    #bottom-nav-add-btn { display: none !important; } /* Ocultar FAB en escritorio */
    
    /* Colores específicos nav escritorio */
    body[data-ledger-mode="A"] .bottom-nav__item--active { background-color: var(--c-primary); color: var(--c-white); }
    body[data-ledger-mode="B"] .bottom-nav__item--active { background-color: var(--c-danger); color: var(--c-white) !important; }
}
/* --- Fix iOS Input Zoom --- */
@media screen and (-webkit-min-device-pixel-ratio: 0) { 
    select:focus, textarea:focus, input:focus { font-size: 16px !important; }
}